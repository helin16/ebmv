var FrontPageJs=new Class.create();FrontPageJs.prototype={productDetailsUrl:"/product/{id}",_currentLib:null,callbackIds:{},initialize:function(){},setCallbackId:function(a,b){this.callbackIds[a]=b;return this},getCallbackId:function(a){if(this.callbackIds[a]===undefined||this.callbackIds[a]===null){throw"Callback ID is not set for:"+a}return this.callbackIds[a]},postAjax:function(d,c,e,b){var a={};a.request=new Prado.CallbackRequest(d,e);a.request.setCallbackParameter(c);a.timeout=(b||30000);if(a.timeout<30000){a.timeout=30000}a.request.setRequestTimeOut(a.timeout);a.request.dispatch();return a.request},getResp:function(b,a,d){var c={};c.expectNonJSONResult=(a!==true?false:true);c.result=b;if(c.expectNonJSONResult===true){return c.result}if(!c.result.isJSON()){c.error="Invalid JSON string: "+c.result;if(d===true){throw c.error}else{return alert(c.error)}}c.result=c.result.evalJSON();if(c.result.errors.size()!==0){c.error="Error: \n\n"+c.result.errors.join("\n");if(d===true){throw c.error}else{return alert(c.error)}}return c.result.resultData},getCurrency:function(f,c,b,a,e){var d={};d.decimal=(isNaN(b=Math.abs(b))?2:b);d.dollar=(c==undefined?"$":c);d.decimalPoint=(a==undefined?".":a);d.thousandPoint=(e==undefined?",":e);d.sign=(f<0?"-":"");d.Int=parseInt(f=Math.abs(+f||0).toFixed(d.decimal))+"";d.j=(d.j=d.Int.length)>3?d.j%3:0;return d.dollar+d.sign+(d.j?d.Int.substr(0,d.j)+d.thousandPoint:"")+d.Int.substr(d.j).replace(/(\d{3})(?=\d)/g,"$1"+d.thousandPoint)+(d.decimal?d.decimalPoint+Math.abs(f-d.Int).toFixed(d.decimal).slice(2):"")},keydown:function(c,a,b){if(!((c.which&&c.which==13)||(c.keyCode&&c.keyCode==13))){if(typeof(b)==="function"){b()}return true}if(typeof(a)==="function"){a()}return false},_getProductThumbnail:function(b){var a={};a.me=this;a.productDiv=new Element("div",{"class":"thumbnail nodefault",title:b.title}).insert({bottom:new Element("a",{href:a.me.getProductDetailsUrl(b.id)}).update(a.me._getProductImgDiv(b.attributes.image_thumb||null))}).insert({bottom:new Element("div",{"class":"caption"}).insert({bottom:b.title})});return a.productDiv},showDetailsPage:function(a){window.location=this.getProductDetailsUrl(a)},getProductDetailsUrl:function(a){return this.productDetailsUrl.replace("{id}",a)},_getProductImgDiv:function(a){var b={};b.loadingImg=new Image();b.loadingImg.writeAttribute("data-src","holder.js/100%x180").writeAttribute("src","data:image/gif;base64,R0lGODlhyADwAMZAAAQCBAQGBAwKDAwODBQSFBQWFBwaHBweHCQiJCQmJCwqLCwuLDQyNDQ2NDw6PDw+PERCRERGRExKTExOTFRSVFRWVFxaXFxeXGRiZGRmZGxqbGxubHRydHR2dHx6fHx+fISChISGhIyKjIyOjJSSlJSWlJyanJyenKSipKSmpKyqrKyurLSytLS2tLy6vLy+vMTCxMTGxMzKzMzOzNTS1NTW1Nza3Nze3OTi5OTm5Ozq7Ozu7PTy9PT29Pz6/Pz+/P///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh/hFDcmVhdGVkIHdpdGggR0lNUAAh+QQIBgD/ACxWAFsAIAAgAAAH/oBAgoOEhYaHiIQyFxcwiY+INgEAlC6Ql4MflJQRmIg/MCYsPSCbAAyDLxMrnjwQmwYnk5Qggj8JAAI/mBqmAAMqEAkfPoMRAAu7kD8DvgAfhzwsO5g+s6YXno+vvh6YPyuWhzLXvziYJZSOhzEOlA0yniKUMYk/PDvK1Sctlz4uKVzw0PboR4lmlAaI0EeQkAdnADg0LBQDIj1MNUDMKITBIgAN/ggACKCDUAOPEC71EEDpBiF3FitgenEhRaGHFktMHISj3KYEPXYOasHS1IEa1ahFunBAgIIPSiHVKADgQrFPDAnNgLDABKFelSb+QLDpxaARZSfmMOVNkI8NFww+ZK1mYBMroYZiMCggF+8nv4ADIwoEACH5BAkGAH8ALFYAWwAgACAAAAf+gECCg4SFhoeIiYqLhj0eGjmMkoMiAAASk4o/P4IglguELxMrmTIPAQgjPjsSCS2DPwgAApyMNwKWlhyIEAALtYshubk6hzstPJMdw5YvmYkuzACRjD8qLog/F8MdkySWMNkqFhQpwIuVADHPjD4nr+zxiDwqICc78ocuBbkCKfmEbASQtk5SDRAzDGWQBoCC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");b.imgSRC="/themes/images/no_image_found.jpg";if(a!==undefined&&a!==null&&a.size()>0){b.imgSRC="/asset/get?id="+a[0].attribute}b.img=new Image();b.img.writeAttribute("data-src","holder.js/100%x180").writeAttribute("src",b.imgSRC).observe("load",function(){b.loadingImg.replace(b.img)});return b.loadingImg},getUser:function(d,e,a,b){var c={};c.me=this;c.me.postAjax(c.me.getCallbackId("getUser"),{},{onLoading:function(){if(typeof(a)==="function"){a()}},onComplete:function(f,h){try{c.result=c.me.getResp(h,false,true);if(typeof(e)==="function"){e()}}catch(g){jQuery("#"+d.id).popover({html:true,placement:"auto",title:"登陆/登陸/Sign In",content:c.me._getLoginPanel(d,b),container:"body"}).popover("show")}}})},_getLoginPanel:function(c,a){var b={};b.me=this;return new Element("div",{"class":"login-form loginpanel",role:"form"}).insert({bottom:new Element("div",{"class":"row msgpanel"})}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"for":"username"}).update("图书馆卡号/圖書館卡號/Library Card No.")}).insert({bottom:new Element("div",{"class":"input-group"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-user"})})}).insert({bottom:new Element("input",{id:"username",type:"text","class":"form-control username",placeholder:"Username",required:true,autofocus:true}).observe("keydown",function(d){pageJs.keydown(d,function(){$(Event.element(d)).up(".loginpanel").down(".loginbtn").click()})})})})}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"for":"password"}).update("密码/密碼/PIN")}).insert({bottom:new Element("div",{"class":"input-group"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-lock"})})}).insert({bottom:new Element("input",{id:"password",type:"password","class":"form-control password",placeholder:"Password",required:true}).observe("keydown",function(d){pageJs.keydown(d,function(){$(Event.element(d)).up(".loginpanel").down(".loginbtn").click()})})})})}).insert({bottom:new Element("div",{"class":"form-group btns"}).insert({bottom:new Element("span",{id:"pop_login_btn","class":"loginbtn btn btn-sm btn-primary btn-block iconbtn","data-loading-text":"登陆中/登陸中/Processing..."}).insert({bottom:new Element("div",{"class":"btnname"}).insert({bottom:"登陆/登陸"}).insert({bottom:new Element("small").update("Sign in")})}).observe("click",function(){b.me._login(this,null,function(){window.location=document.URL})})}).insert({bottom:new Element("span",{"class":"btn btn-sm btn-default btn-block iconbtn"}).insert({bottom:new Element("div",{"class":"btnname"}).insert({bottom:"取消/撤消"}).insert({bottom:new Element("small").update("Cancel")})}).observe("click",function(){jQuery(c).popover("hide");if(typeof(a)==="function"){a()}})})})},_getErrMsg:function(a){return new Element("span",{"class":"errmsg smalltxt"}).update(a)},_login:function(c,a,d){var b={};b.me=this;b.panel=$(c).up(".loginpanel");b.usernamebox=b.panel.down(".username");b.passwordbox=b.panel.down(".password");if(b.me._preLogin(b.usernamebox,b.passwordbox)===false){return}b.loadingMsg=new Element("div",{"class":"loadingMsg"}).update("log into system ...");b.me.postAjax(b.me.getCallbackId("loginUser"),{username:$F(b.usernamebox),password:$F(b.passwordbox)},{onLoading:function(){$(c).up(".row").hide().insert({after:b.loadingMsg});b.panel.down(".msgpanel").update("");if(typeof(a)==="function"){a()}},onComplete:function(f,h){try{b.result=b.me.getResp(h,false,true);if(typeof(d)==="function"){d()}}catch(g){$(b.usernamebox).select();b.panel.down(".msgpanel").update(b.me._getErrMsg(g))}b.loadingMsg.remove();$(c).up(".row").show()}})},_preLogin:function(c,a){var b={};b.me=this;b.loginPanel=$(c).up(".loginpanel");b.loginPanel.getElementsBySelector(".has-error").each(function(d){d.removeClassName("has-error")});b.loginPanel.down(".msgpanel").update("");b.me.errorMsg="";if($F(c).blank()){$(c).up(".form-group").addClassName("has-error");b.me.errorMsg+='<span class="label label-danger">Username is required</span> '}if($F(a).blank()){$(a).up(".form-group").addClassName("has-error");b.me.errorMsg+='<span class="label label-danger">Password is required</span> '}if(!b.me.errorMsg.blank()){b.loginPanel.down(".msgpanel").update(b.me.errorMsg);return false}return true}};