var PageJs=new Class.create();PageJs.prototype=Object.extend(new CrudPageJs(),{types:null,_getItemRow:function(c,b){var a={};a.me=this;a.div=new Element("div",{"class":"row",item_id:c.id}).store("item",c).insert({bottom:new Element("span",{"class":"col id"}).update(c.id)}).insert({bottom:new Element("span",{"class":"col name"}).update(c.name)}).insert({bottom:new Element("span",{"class":"col active"}).update(c.istitle===true?c.active:new Element("input",{type:"checkbox",checked:c.active,disabled:true}))}).insert({bottom:new Element("span",{"class":"col btns"}).update(b)}).insert({bottom:a.me._getInfoDiv(c)});return a.div},_getItemRowEditBtn:function(b){var a={};a.me=this;return new Element("span").insert({bottom:new Element("span",{"class":"btn editbtn",title:"EDIT"}).observe("click",function(){a.me.editItem(this)})}).insert({bottom:new Element("span",{"class":"btn delbtn",title:"DELETE"}).observe("click",function(){a.me.delItems([b.id])})}).insert({bottom:new Element("span",{"class":"btn importbtn",title:"IMPORT"}).observe("click",function(){a.btn=this;$(a.btn).hide().insert({after:new Element("span",{"class":"loadingImg"})});try{pImportView.load(null,{id:b.id,name:b.name},function(){$(a.btn).show().next(".loadingImg").remove()})}catch(c){$(a.btn).show().next(".loadingImg").remove();alert(c)}})})},_hideShowAllEditPens:function(){var a={};a.savePanel=$(this.resultDivId).down(".savePanel");if(a.savePanel){a.savePanel.down(".cancelBtn").click()}return this},showEditPanel:function(c,a){var b={};b.me=this;if(a===true){$(b.me.resultDivId).down(".row.titleRow").insert({after:b.me._getSavePanel({},"addDiv")})}else{b.row=$(c).up(".row");b.row.replace(this._getSavePanel(b.row.retrieve("item"),"editDiv"))}return this},_getResultDiv:function(a,b,d){var c={};c.me=this;c.includetitlerow=(b===false?false:true);c.resultDiv=new Element("div");if(c.includetitlerow===true){c.resultDiv.insert({bottom:c.me._getItemRow({id:"id",name:"Name",active:"active",istitle:true},new Element("span",{"class":"button padding5 rdcrnr"}).update("Create NEW").observe("click",function(){c.me.createItem(this)})).addClassName("titleRow")})}c.i=(d||0);a.each(function(e){c.resultDiv.insert({bottom:c.me._getItemRow(e,c.me._getItemRowEditBtn(e)).addClassName(c.i%2===1?"even":"odd")});c.i++});return c.resultDiv},_getInfoDiv:function(b){var a={};a.me=this;a.div=new Element("div",{"class":"attrs_wrapper"});a.code="";$H(b.info).each(function(c){a.attrCode=c.key;if(typeof(c.value)==="object"){a.attrDiv=new Element("div",{"class":"attr_wrapper"});a.attrDiv.insert({bottom:new Element("span",{"class":"attr_name inlineblock"}).update(c.value[0].type.name)});if(a.attrCode!==a.code){a.code=a.attrCode}a.attrValeusDiv=new Element("span",{"class":"attr_values_wrapper inlineblock"});c.value.each(function(d){a.attrValeusDiv.insert({bottom:new Element("div",{"class":"attr_value"}).update(d.value)})});a.attrDiv.insert({bottom:a.attrValeusDiv});a.div.insert({bottom:a.attrDiv})}});return a.div},cancelEdit:function(b){var a={};a.me=this;a.item=$(b).up(".savePanel").retrieve("item");if(a.item.id===undefined||a.item.id===null){$(b).up(".savePanel").remove()}else{$(b).up(".savePanel").replace(a.me._getItemRow(a.item,a.me._getItemRowEditBtn(a.item)))}return this},_collectSavePanel:function(b){var a={};a.me=this;a.hasError=false;a.data={};a.savePanel=$(b).up(".savePanel");a.item=a.savePanel.retrieve("item");a.data.id=(a.item.id===null||a.item.id===undefined?"":a.item.id);a.savePanel.getElementsBySelector(".hasError").each(function(c){if(c.down(".errmsg")){c.down(".errmsg").remove()}c.removeClassName("hasError")});a.savePanel.getElementsBySelector("[colname]").each(function(c){a.fieldValue=$F(c);a.field=c.readAttribute("colname");if(a.fieldValue.blank()&&c.readAttribute("noblank")){$(c).up(".fielddiv").addClassName("hasError").down(".value").insert({after:new Element("span",{"class":"errmsg smalltxt"}).update(a.field+" is required!")});a.hasError=true}a.data[a.field]=$F(c)});a.attrs=[];a.savePanel.getElementsBySelector("[attr_id]").each(function(c){a.fieldValue=$F(c);a.attrId=c.readAttribute("attr_id");a.attrTypeId=c.readAttribute("attr_type_id");if(a.fieldValue.blank()&&c.readAttribute("noblank")){$(c).up(".fielddiv").addClassName("hasError").down(".value").insert({after:new Element("span",{"class":"errmsg smalltxt"}).update("required!")});a.hasError=true}a.attrs.push({id:a.attrId,typeId:a.attrTypeId,value:a.fieldValue})});a.data.info=a.attrs;return a.hasError===true?null:a.data},_afterSaveItems:function(c,a){var b={};b.item=a.items[0];$(c).up(".savePanel").replace(this._getItemRow(b.item,this._getItemRowEditBtn(b.item)));return this},_getSavePanel:function(c,a){var b={};b.me=this;b.isNew=(c.id===undefined||c.id===null);b.newDiv=new Element("div",{"class":"savePanel"}).addClassName(a).store("item",c).insert({bottom:b.me._getSaveFieldDiv("Name",new Element("input",{value:(b.isNew?"":c.name),"class":"txt value",colname:"name",noblank:true}))}).insert({bottom:b.me._getSaveFieldDiv("Act?",new Element("input",{type:"checkbox","class":"value",checked:(b.isNew===true?true:c.active),disabled:b.isNew,colname:"active"}))}).insert({bottom:new Element("span",{"class":"button padding5 rdcrnr saveBtn"}).update("Save").observe("click",function(){b.me.saveEditedItem(this)})}).insert({bottom:new Element("span",{"class":"button padding5 rdcrnr cancelBtn"}).update("Cancel").observe("click",function(){b.me.cancelEdit(this)})}).insert({bottom:b.me._getSaveAttrPanel(c.info)});return b.newDiv},_getNewAttrDiv:function(){var a={};a.me=this;a.typeSelection=new Element("select").update(new Element("option",{value:""}).update("Pls Select:")).observe("change",function(){$(this).up(".fielddiv").replace(a.me._getSaveFieldDiv($(this).options[$(this).selectedIndex].innerHTML,new Element("input",{value:"","class":"txt value",attr_id:"",attr_type_id:$F(this),noblank:true}),true))});a.me.types.each(function(b){a.typeSelection.insert({bottom:new Element("option",{value:b.id}).update(b.name)})});return a.me._getSaveFieldDiv("Please Select a type: ",a.typeSelection,true)},_getSaveAttrPanel:function(a){var b={};b.me=this;b.div=new Element("div",{"class":"attrs_div"});$H(a).each(function(c){if(typeof(c.value)==="object"){c.value.each(function(d){b.div.insert({bottom:b.me._getSaveFieldDiv(d.type.name,new Element("input",{value:d.value,"class":"txt value",attr_id:d.id,attr_type_id:d.type.id,noblank:true}),true)})})}});b.div.insert({bottom:b.me._getSaveFieldDiv("",new Element("span",{"class":"button padding5 rdcrnr"}).update("NEW Info").observe("click",function(){$(this).up(".fielddiv").insert({before:b.me._getNewAttrDiv()})}))});return b.div},_getSaveFieldDiv:function(d,c,b){var a={};a.me=this;a.showDelBtn=(b===true?true:false);a.titleDiv=new Element("span",{"class":"title"}).update(d);if(a.showDelBtn===true){a.titleDiv.insert({bottom:new Element("span",{"class":"inlineblock btns"}).insert({bottom:new Element("span",{"class":"delBtn cursorpntr"}).update("x").observe("click",function(){if(!confirm("You are about to delete this attribute.\n Continue?")){return false}$(this).up(".fielddiv").fade();if($(this).up(".fielddiv").down(".value")){$(this).up(".fielddiv").down(".value").writeAttribute("deactivated",true)}})})})}return new Element("div",{"class":"fielddiv inlineblock padding5"}).insert({bottom:a.titleDiv}).insert({bottom:new Element("span",{"class":"content"}).update(c)})}});