var PageJs=new Class.create
PageJs.prototype=Object.extend(new CrudPageJs,{types:null,_geDl:function(e,t){return new Element("dl").insert({bottom:new Element("dt").update(e)}).insert({bottom:new Element("dd").update(t)})},_getInputGroup:function(e,t){return new Element("div",{"class":"input-group input-group-sm"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update(e)}).insert({bottom:new Element("span",{"class":"form-control"}).update(t)})},_getItemRow:function(e,t){var n={}
return n.me=this,n.div=new Element("div",{"class":"panel panel-primary item",item_id:e.id}).store("item",e).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("div",{"class":"panel-title"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-1"}).update(e.id)}).insert({bottom:new Element("div",{"class":"col-sm-4"}).update(e.name)}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(e.connector)}).insert({bottom:new Element("div",{"class":"col-sm-1"}).update(new Element("input",{type:"checkbox",checked:e.active,disabled:!0}))}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(t.addClassName("pull-right"))})})})}).insert({bottom:n.me._getInfoDiv(e)}),n.div},_getItemRowEditBtn:function(e){var t={}
return t.me=this,new Element("span",{"class":"btn-group btn-group-xs"}).insert({bottom:new Element("span",{id:"edit_btn"+e.id,"class":"btn btn-default",title:"EDIT","data-loading-text":"Processing..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-pencil"})}).insert({bottom:" Edit"}).observe("click",function(){t.me.editItem(this)})}).insert({bottom:new Element("span",{id:"del_btn"+e.id,"class":"btn btn-danger",title:"DELETE","data-loading-text":"Processing..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).insert({bottom:" Delete"}).observe("click",function(){t.me.delItems([e.id])})}).insert({bottom:new Element("span",{id:"import_btn"+e.id,"class":"btn btn-default",title:"IMPORT","data-loading-text":"Processing..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-download"})}).insert({bottom:" Import"}).observe("click",function(){t.btn=this,jQuery(t.btn.id).button("loading")
try{pImportView.load(null,{id:e.id,name:e.name},function(){jQuery(t.btn.id).button("reset")})}catch(n){jQuery(t.btn.id).button("reset"),alert(n)}})})},_hideShowAllEditPens:function(){var e={}
return e.savePanel=$(this.resultDivId).down(".savePanel"),e.savePanel&&e.savePanel.down(".cancelBtn").click(),this},showEditPanel:function(e,t){var n={}
return n.me=this,t===!0?$(n.me.resultDivId).down(".item.titleRow").insert({after:n.me._getSavePanel({},"addDiv")}):(n.row=$(e).up(".item"),n.row.replace(this._getSavePanel(n.row.retrieve("item"),"editDiv"))),this},_getResultDiv:function(e,t,n){var i={}
return i.me=this,i.includetitlerow=t===!1?!1:!0,i.resultDiv=new Element("div"),i.includetitlerow===!0&&i.resultDiv.insert({bottom:new Element("p",{"class":"item titleRow"}).insert({bottom:new Element("span",{"class":"btn btn-success"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus-sign"})}).insert({bottom:" Create NEW"}).observe("click",function(){i.me.createItem(this)})})}),i.i=n||0,e.each(function(e){i.resultDiv.insert({bottom:i.me._getItemRow(e,i.me._getItemRowEditBtn(e))}),i.i++}),i.resultDiv},_getUserEditBtn:function(e,t){var n={}
return n.me=this,new Element("span",{"class":"btn btn-default btn-xs lib-admin-user-btn","user-id":t.id,style:"display: inline-block; margin: 0 10px 0px 0",title:"Edit user"}).update(t.person.fullname).observe("click",function(){n.me._openUserEditPage(e,t.id)})},_openUserEditPage:function(e,t){var n={}
return n.me=this,jQuery.fancybox({autoScale:!0,autoDimensions:!0,fitToView:!0,autoSize:!0,type:"iframe",href:"/admin/libadminuser/"+e+"/"+t+".html",beforeClose:function(){n.user=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._user,n.userBtn=n.me._getUserEditBtn(e,n.user),"new"===t?$(n.me.resultDivId).down(".item[item_id="+e+"] .user-list-div").insert({top:n.userBtn}):(n.rowBtn=$(n.me.resultDivId).down(".item[item_id="+e+"] .user-list-div .lib-admin-user-btn[user-id="+n.user.id+"]"),n.rowBtn&&n.rowBtn.replace(n.userBtn))}}),n.me},_getInfoDiv:function(e){var t={}
return t.me=this,t.div=new Element("small",{"class":"list-group"}),t.code="",$H(e.info).each(function(e){t.attrCode=e.key,"object"==typeof e.value&&(t.attrDiv=new Element("dl",{"class":"list-group-item dl-horizontal"}),t.attrDiv.insert({bottom:new Element("dt").update(e.value[0].type.name)}),t.attrCode!==t.code&&(t.code=t.attrCode),t.attrValeusDiv=new Element("dd"),e.value.each(function(e){t.attrValeusDiv.insert({bottom:new Element("span",{"class":"attr_value",style:"display: inline-block; margin: 0 15px 0px 0"}).update(e.value)})}),t.attrDiv.insert({bottom:t.attrValeusDiv}),t.div.insert({bottom:t.attrDiv}))}),t.div.insert({bottom:new Element("dl",{"class":"list-group-item dl-horizontal"}).insert({bottom:new Element("dt").update("Admin Users:")}).insert({bottom:t.userList=new Element("dd",{"class":"user-list-div"}).update(new Element("span",{"class":"btn btn-primary btn-xs",title:"Add a new library admin user"}).update(new Element("span",{"class":"glyphicon glyphicon-plus"})).observe("click",function(){t.me._openUserEditPage(e.id,"new")}))})}),e.adminusers.each(function(n){t.userList.insert({top:t.me._getUserEditBtn(e.id,n)})}),t.div},cancelEdit:function(e){var t={}
return t.me=this,t.item=$(e).up(".savePanel").retrieve("item"),void 0===t.item.id||null===t.item.id?$(e).up(".savePanel").remove():$(e).up(".savePanel").replace(t.me._getItemRow(t.item,t.me._getItemRowEditBtn(t.item))),this},_collectSavePanel:function(e){var t={}
return t.me=this,t.data={},t.savePanel=$(e).up(".savePanel"),t.item=t.savePanel.retrieve("item"),t.data.id=null===t.item.id||void 0===t.item.id?"":t.item.id,t.savePanel.down(".msgRow").update(""),t.savePanel.getElementsBySelector(".has-error").each(function(e){e.removeClassName("has-error")}),t.errMsg="",t.savePanel.getElementsBySelector("[colname]").each(function(e){t.fieldValue=$F(e),t.field=e.readAttribute("colname"),t.fieldValue.blank()&&e.readAttribute("noblank")&&($(e).up(".form-group").addClassName("has-error"),t.errMsg+="<li>"+t.field+" is required</li>"),t.data[t.field]=$F(e)}),t.attrs=[],t.savePanel.getElementsBySelector("[attr_id]").each(function(e){t.fieldValue=$F(e),t.attrId=e.readAttribute("attr_id"),t.attrTypeId=e.readAttribute("attr_type_id"),t.fieldValue.blank()&&e.readAttribute("noblank")&&($(e).up(".form-group").addClassName("has-error"),t.errMsg+="<li>"+$(e).up(".form-group").down(".control-label").innerHTML+" is required</li>"),t.attrs.push({id:t.attrId,typeId:t.attrTypeId,value:t.fieldValue,active:e.hasAttribute("deactivated")?0:1})}),t.data.info=t.attrs,t.errMsg.blank()?t.data:(t.savePanel.down(".msgRow").update(new Element("p",{"class":"alert alert-danger"}).update(t.errMsg)),null)},_afterSaveItems:function(e,t){var n={}
return n.item=t.items[0],$(e).up(".savePanel").replace(this._getItemRow(n.item,this._getItemRowEditBtn(n.item))),this},_getSaveFieldDiv:function(e,t,n){var i={}
return i.me=this,i.showDelBtn=n===!0?!0:!1,i.ddDiv=new Element("dd").insert({bottom:t.addClassName("form-control")}),i.showDelBtn===!0&&i.ddDiv.addClassName("input-group input-group-sm").insert({bottom:new Element("span",{"class":"btn btn-default input-group-addon"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){return confirm("You are about to delete this attribute.\n Continue?")?($(this).up(".fielddiv").down(".value")&&$(this).up(".fielddiv").down(".value").writeAttribute("deactivated",!0),void $(this).up(".fielddiv").fade()):!1})}),new Element("dl",{"class":"form-group fielddiv"}).insert({bottom:new Element("dt",{"class":"control-label"}).update(e)}).insert({bottom:i.ddDiv})},_getSavePanel:function(e,t){var n={}
return n.me=this,n.isNew=void 0===e.id||null===e.id,n.newDiv=new Element("div",{"class":"panel panel-default savePanel"}).addClassName(t).store("item",e).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("div",{"class":"panel-title"}).insert({bottom:n.isNew===!0?"Creating a new Library:":"Editing the Library: "+e.name}).insert({bottom:new Element("span",{"class":"btn-group btn-group-xs pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary saveBtn"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok-circle"})}).insert({bottom:" Save"}).observe("click",function(){n.me.saveEditedItem(this)})}).insert({bottom:new Element("span",{"class":"btn btn-default cancelBtn"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-circle"})}).insert({bottom:" Cancel"}).observe("click",function(){n.me.cancelEdit(this)})})})})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"msgRow"})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:n.me._getSaveFieldDiv("Name",new Element("input",{value:n.isNew?"":e.name,"class":"txt value",colname:"name",noblank:!0,placeholder:"The name of the library"})).addClassName("col-xs-7")}).insert({bottom:n.me._getSaveFieldDiv("Connector",new Element("input",{value:n.isNew?"":e.connector,"class":"txt value",colname:"connector",noblank:!0,placeholder:"The connector script of the library"})).addClassName("col-xs-4")}).insert({bottom:n.me._getSaveFieldDiv("Act?",new Element("input",{type:"checkbox","class":"value",checked:n.isNew===!0?!0:e.active,disabled:n.isNew,colname:"active"})).addClassName("col-xs-1")})})}).insert({bottom:n.me._getSaveAttrPanel(e.info)}),n.newDiv},_getNewAttrDiv:function(){var e={}
return e.me=this,e.typeSelection=new Element("select").update(new Element("option",{value:""}).update("Pls Select:")).observe("change",function(){$(this).up(".list-group-item").replace(e.me._getSaveFieldDiv($(this).options[$(this).selectedIndex].innerHTML,new Element("input",{value:"","class":"txt value",attr_id:"",attr_type_id:$F(this),noblank:!0}),!0).addClassName("list-group-item dl-horizontal"))}),e.me.types.each(function(t){e.typeSelection.insert({bottom:new Element("option",{value:t.id}).update(t.name)})}),e.me._getSaveFieldDiv("Please Select a type: ",e.typeSelection,!0)},_getSaveAttrPanel:function(e){var t={}
return t.me=this,t.div=new Element("div",{"class":"list-group"}),$H(e).each(function(e){"object"==typeof e.value&&e.value.each(function(e){t.div.insert({bottom:t.me._getSaveFieldDiv(e.type.name,new Element("input",{value:e.value,"class":"txt value",attr_id:e.id,attr_type_id:e.type.id,noblank:!0}),!0).addClassName("list-group-item dl-horizontal")})})}),t.div.insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus-sign"})}).insert({bottom:" NEW Info"}).observe("click",function(){$(this).insert({before:t.me._getNewAttrDiv().addClassName("list-group-item dl-horizontal")})})}),t.div}})