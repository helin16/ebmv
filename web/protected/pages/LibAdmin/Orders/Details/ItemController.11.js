var PageJs=new Class.create();PageJs.prototype=Object.extend(new FrontPageJs(),{htmlIDs:{orderDetailsDiv:""},_order:{},setHTMLIds:function(a){this.htmlIDs.orderDetailsDiv=a;return this},setOrder:function(a){this._order=a;return this},_deleteItem:function(b){var a={};a.me=this;a.row=b.up(".item-row");a.item=a.row.retrieve("data");a.me.postAjax(a.me.getCallbackId("delItem"),a.item,{onLoading:function(){},onSuccess:function(c,f){try{a.result=a.me.getResp(f,false,true);if(!a.result.item){return}a.items=[];a.me._order.items.each(function(e){if(e.id!==a.result.item.id){a.items.push(e)}});a.me._order.items=a.items;a.row.remove()}catch(d){a.me.showModalbox("ERROR",d,true)}}});return a.me},_getItemsRow:function(c,a){var b={};b.me=this;b.isTitle=(a===true?true:false);b.tag=(b.isTitle===true?"th":"td");b.qty=(b.me._order.status!=="OPEN"?c.qty:new Element("div",{"class":"input-group input-group-sm"}).insert({bottom:new Element("input",{"class":"form-control order-qty","save-order":"item-qty",type:"text","item-id":c.id,value:c.qty,style:"padding: 4px;"})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{"class":"btn btn-danger"}).update(new Element("span",{"class":"glyphicon glyphicon-trash"})).observe("click",function(){if(!confirm("Do you want to delete this item from this order?")){return false}b.me._deleteItem(this)})})}));b.newDiv=new Element("tr",{"class":"item-row"}).store("data",c).insert({bottom:new Element(b.tag,{"class":""}).update(b.isTitle===true?new Element("span").insert({bottom:new Element("input",{type:"checkbox",id:"mark-all-marc"}).observe("click",function(){b.checked=this.checked;$$("[save-order=need-marc]").each(function(d){d.checked=b.checked})})}).insert({bottom:new Element("label",{"for":"mark-all-marc"}).update(" <small>MARC?</small>")}):new Element("input",{type:"checkbox","save-order":"need-marc"}))}).insert({bottom:new Element(b.tag).update(b.isTitle===true?"Title":new Element("abbr",{title:(!c.product.attributes.description?"":c.product.attributes.description[0].attribute)}).update(c.product.title))}).insert({bottom:new Element(b.tag,{"class":"col-sm-1"}).update(b.isTitle===true?"ISBN":(!c.product.attributes.isbn?"":c.product.attributes.isbn[0].attribute))}).insert({bottom:new Element(b.tag,{"class":"col-sm-1"}).update(b.isTitle===true?"Author":(!c.product.attributes.author?"":c.product.attributes.author[0].attribute))}).insert({bottom:new Element(b.tag,{"class":"col-sm-2"}).update(b.isTitle===true?"Publish":(!c.product.attributes.publisher?"":c.product.attributes.publisher[0].attribute)+"<div><em> @ "+(!c.product.attributes.publish_date?"":c.product.attributes.publish_date[0].attribute)+"</em></div>")}).insert({bottom:new Element(b.tag,{"class":"col-sm-1 text-right"}).update(b.isTitle===true?"Unit Price":b.me.getCurrency(c.unitPrice))}).insert({bottom:new Element(b.tag,{"class":"col-sm-1"}).update(b.isTitle===true?"Qty":b.qty)}).insert({bottom:new Element(b.tag,{"class":"col-sm-1 text-right"}).update(b.isTitle===true?"Total Price":b.me.getCurrency(c.totalPrice))});return b.newDiv},_saveItem:function(b){var a={};a.me=this;a.me._signRandID(b);a.data={id:a.me._order.id,comments:$F($$("[save-order=comments]").first()),items:[]};$$("[save-order=item-qty]").each(function(c){a.data.items.push({id:c.readAttribute("item-id"),qty:$F(c),needMARC:$(c).up(".item-row").down("[save-order=need-marc]").checked})});a.me.postAjax(a.me.getCallbackId("saveOrder"),a.data,{onLoading:function(){jQuery("#"+b.id).button("loading")},onSuccess:function(c,f){try{a.result=a.me.getResp(f,false,false);if(!a.result.order){return}a.me.showModalBox("Success","Order Saved Successfully!",true);window.location=document.URL}catch(d){a.me.showModalbox("ERROR",d,true)}},onComplete:function(){jQuery("#"+b.id).button("reset")}});return a.me},displayOrder:function(){var a={};a.me=this;a.dateString="";if(a.me._order.submitDate!=="0001-01-01 00:00:00"&&!a.me._order.submitDate.blank()){a.date=a.me.loadUTCTime(a.me._order.submitDate);a.dateString=a.date.getDate()+"/"+(a.date.getMonth()*1+1)+"/"+a.date.getFullYear()}a.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-3"}).insert({bottom:new Element("dl").insert({bottom:new Element("dt").update("Order No.:")}).insert({bottom:new Element("dd").update(a.me._order.orderNo)})})}).insert({bottom:new Element("div",{"class":"col-sm-3"}).insert({bottom:new Element("dl").insert({bottom:new Element("dt").update("Order status.:")}).insert({bottom:new Element("dd").update(a.me._order.status)})})}).insert({bottom:new Element("div",{"class":"col-sm-3"}).insert({bottom:new Element("dl").insert({bottom:new Element("dt").update("Order Date.:")}).insert({bottom:new Element("dd").update(a.dateString)})})}).insert({bottom:new Element("div",{"class":"col-sm-3"}).insert({bottom:new Element("dl").insert({bottom:new Element("dt").update("Order By.:")}).insert({bottom:new Element("dd").update(a.me._order.submitBy&&a.me._order.submitBy.person?a.me._order.submitBy.person.fullname:"")})})})}).insert({bottom:new Element("table",{"class":"table table-striped table-hover"}).insert({bottom:new Element("thead").update(a.me._getItemsRow({},true))}).insert({bottom:a.tbody=new Element("tbody")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-12"}).insert({bottom:new Element("strong").update("comments:")}).insert({bottom:a.me._order.status!=="OPEN"?new Element("div",{"class":"panel panel-default"}).update(new Element("div",{"class":"panel-body"}).update(a.me._order.comments)):new Element("textarea",{"class":"form-control","save-order":"comments"}).update(a.me._order.comments)})})});a.me._order.items.each(function(b){a.tbody.insert({bottom:a.me._getItemsRow(b,false)})});if(a.me._order.status==="OPEN"){a.newDiv.insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("span",{"class":"btn btn-primary pull-right col-sm-4","data-loading-text":"saving ..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-upload"})}).insert({bottom:" Submit This Order"}).observe("click",function(){a.me._saveItem(this)})})})}$(a.me.htmlIDs.orderDetailsDiv).update(a.newDiv);return a.me}});