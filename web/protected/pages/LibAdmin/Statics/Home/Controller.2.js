var PageJs=new Class.create;PageJs.prototype=Object.extend(new FrontPageJs,{pagination:{pageNo:1,pageSize:30},_htmlIds:{resultListId:"",totalCountDivId:""},setHTMLIDs:function(t,e){return this._htmlIds.resultListId=t,this._htmlIds.totalCountDivId=e,this},_getPaginBtns:function(t){if(!(t.pageNumber>=t.totalPages)){var e={};return e.me=this,e.paginDiv=new Element("tfoot",{"class":"paginDiv"}).insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:6}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Getting more ..."}).update("Get more").observe("click",function(){e.btn=this,e.me._signRandID(e.btn),jQuery("#"+e.btn.id).button("loading"),e.me.load(e.me.pagination.pageNo+1,e.me.pagination.pageSize,!1,function(){$(e.btn).up(".paginDiv").remove()})})})})}),e.paginDiv}},_getResultRow:function(t,e){var n={};return n.me=this,n.isTitle=e||!1,n.tag=n.isTitle===!0?"th":"td",n.newRow=new Element("tr").insert({bottom:new Element(n.tag).update(n.isTitle===!0?"Views":t.statics[1]&&t.statics[1].value&&!t.statics[1].value.blank()?t.statics[1].value:"0")}).insert({bottom:new Element(n.tag).update(n.isTitle===!0?"Borrows":t.statics[2]&&t.statics[2].value&&!t.statics[2].value.blank()?t.statics[2].value:"0")}).insert({bottom:new Element(n.tag).update(t.title)}).insert({bottom:new Element(n.tag).update(n.isTitle===!0?"ISBN":t.attributes.isbn?t.attributes.isbn[0].attribute:"")}).insert({bottom:new Element(n.tag).update(n.isTitle===!0?"Author":t.attributes.author?t.attributes.author[0].attribute:"")}).insert({bottom:new Element(n.tag).update(n.isTitle===!0?"Publisher":t.attributes.publisher?t.attributes.publisher[0].attribute:"")}).insert({bottom:new Element(n.tag).update(n.isTitle===!0?"Publish Date":t.attributes.publish_date?t.attributes.publish_date[0].attribute:"")}),n.newRow},load:function(t,e,n,o){var i={};return i.me=this,i.me.pagination.pageNo=t||i.me.pagination.pageNo,i.me.pagination.pageSize=e||i.me.pagination.pageSize,i.resetResult=n===!1?!1:!0,i.me.postAjax(i.me.getCallbackId("getStats"),{pagination:i.me.pagination},{onLoading:function(){},onSuccess:function(t,e){try{if(i.result=i.me.getResp(e,!1,!0),!i.result.items||void 0===i.result.items||null===i.result.items)throw"No item found/generated";i.resetResult===!0&&($(i.me._htmlIds.resultListId).update("").insert({bottom:i.me._getResultRow({title:"TITLE"},!0).wrap(new Element("thead"))}),$(i.me._htmlIds.totalCountDivId)&&$(i.me._htmlIds.totalCountDivId).update(i.result.pagination.totalRows)),i.tbody=$(i.me._htmlIds.resultListId).down("tbody"),i.tbody||$(i.me._htmlIds.resultListId).insert({bottom:i.tbody=new Element("tbody")}),i.result.items.each(function(t){i.tbody.insert({bottom:i.me._getResultRow(t)})}),"function"==typeof o&&o(),$(i.me._htmlIds.resultListId).insert({bottom:i.me._getPaginBtns(i.result.pagination)})}catch(n){$(i.me._htmlIds.resultListId).update(i.me.getAlertBox("ERROR",n).addClassName("alert-danger"))}}}),i.me},_submitExport:function(t){var e={};return e.me=this,e.fromDate=$F($$(".date-picker[export-crieria=date-from]").first()),e.toDate=$F($$(".date-picker[export-crieria=date-to]").first()),e.me.postAjax(e.me.getCallbackId("exportSats"),{fromDate:e.fromDate,toDate:e.toDate},{onLoading:function(){e.me._signRandID(t),jQuery("#"+t.id).button("loading")},onSuccess:function(t,n){try{if(e.result=e.me.getResp(n,!1,!0),!e.result.items||void 0===e.result.items||null===e.result.items)throw"No item found/generated";e.i=0,e.resultArray=[],e.result.items.each(function(t){e.title=[],e.row=[],$H(t).each(function(t){e.title.push(""+t.key),e.row.push(""+t.value)}),0===e.i&&e.resultArray.push(e.title.join(", ")),e.resultArray.push(e.row.join(", ")),e.i=1*e.i+1}),e.me.hideModalBox(),e.csvContent="data:text/csv;charset=utf-8,"+e.resultArray.join("\n"),$$("body")[0].insert({bottom:e.newBtn=new Element("a",{href:encodeURI(e.csvContent),download:"my_data.csv"})}),e.newBtn.click(),e.newBtn.remove()}catch(o){e.me.showModalBox("ERROR",'<h4 class="text-danger">'+o+"</h4>")}},onComplete:function(){jQuery("#"+t.id).button("reset")}}),e.me},exportAll:function(){var t={};t.me=this,t.usingIE=window.navigator.userAgent.indexOf("MSIE ")>0||window.navigator.userAgent.indexOf("Trident/")>0,t.now=new Date,t.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"form-horizontal"}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"class":"col-sm-2 control-label"}).update("From:")}).insert({bottom:new Element("div",{"class":"col-sm-10"}).insert({bottom:new Element("input",{type:"text","class":"form-control date-picker",placeholder:"From Date","export-crieria":"date-from",value:t.now.getFullYear()+"-"+("00"+(1*t.now.getMonth()+1)).slice(2)+"-01"})})})}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"class":"col-sm-2 control-label"}).update("To:")}).insert({bottom:new Element("div",{"class":"col-sm-10"}).insert({bottom:new Element("input",{type:"text","class":"form-control date-picker",placeholder:"To Date","export-crieria":"date-to",value:t.now.getFullYear()+"-"+("00"+(1*t.now.getMonth()+1)).slice(2)+"-"+("00"+(1*t.now.getDate()+1)).slice(2)})})})}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"class":"col-sm-offset-2 col-sm-10"}).insert({bottom:t.exportBtn=new Element("a",{"class":"btn "+(t.usingIE===!0?"btn-warning":"btn-primary"),href:"javascript: void(0);","data-loading-text":"Exporting ... Please do NOT close this, while processing!"}).update(t.usingIE===!0?"You can ONLY export this in NON IE browser, sorry!":"Export Now").observe("click",function(){t.me._submitExport(this)})})})})}),t.usingIE===!0&&t.exportBtn.writeAttribute("disabled",!0),pageJs.showModalBox("Please provide a date rage to export:",t.newDiv,!1),$$(".date-picker[export-crieria]").each(function(e){t.me._signRandID(e),e.store("date-picker",new Prado.WebUI.TDatePicker({ID:e.id,InputMode:"TextBox",PositionMode:"Bottom",Format:"yyyy-MM-dd"}))})}});