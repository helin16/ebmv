var PageJs=new Class.create;PageJs.prototype=Object.extend(new FrontPageJs,{pagination:{pageNo:1,pageSize:30},_htmlIds:{resultListId:"",totalCountDivId:""},setHTMLIDs:function(t,e){return this._htmlIds.resultListId=t,this._htmlIds.totalCountDivId=e,this},_getPaginBtns:function(t){if(!(t.pageNumber>=t.totalPages)){var e={};return e.me=this,e.paginDiv=new Element("tfoot",{"class":"paginDiv"}).insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:6}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Getting more ..."}).update("Get more").observe("click",function(){e.btn=this,e.me._signRandID(e.btn),jQuery("#"+e.btn.id).button("loading"),e.me.load(e.me.pagination.pageNo+1,e.me.pagination.pageSize,!1,function(){$(e.btn).up(".paginDiv").remove()})})})})}),e.paginDiv}},_getResultRow:function(t,e){var o={};return o.me=this,o.isTitle=e||!1,o.tag=o.isTitle===!0?"th":"td",o.newRow=new Element("tr").insert({bottom:new Element(o.tag).update(o.isTitle===!0?"Views":t.statics[1]&&t.statics[1].value&&!t.statics[1].value.blank()?t.statics[1].value:"0")}).insert({bottom:new Element(o.tag).update(o.isTitle===!0?"Borrows":t.statics[2]&&t.statics[2].value&&!t.statics[2].value.blank()?t.statics[2].value:"0")}).insert({bottom:new Element(o.tag).update(t.title)}).insert({bottom:new Element(o.tag).update(o.isTitle===!0?"ISBN":t.attributes.isbn?t.attributes.isbn[0].attribute:"")}).insert({bottom:new Element(o.tag).update(o.isTitle===!0?"Author":t.attributes.author?t.attributes.author[0].attribute:"")}).insert({bottom:new Element(o.tag).update(o.isTitle===!0?"Publisher":t.attributes.publisher?t.attributes.publisher[0].attribute:"")}).insert({bottom:new Element(o.tag).update(o.isTitle===!0?"Publish Date":t.attributes.publish_date?t.attributes.publish_date[0].attribute:"")}),o.newRow},load:function(t,e,o,n){var i={};return i.me=this,i.me.pagination.pageNo=t||i.me.pagination.pageNo,i.me.pagination.pageSize=e||i.me.pagination.pageSize,i.resetResult=o===!1?!1:!0,i.me.postAjax(i.me.getCallbackId("getStats"),{pagination:i.me.pagination},{onLoading:function(){},onSuccess:function(t,e){try{if(i.result=i.me.getResp(e,!1,!0),!i.result.items||void 0===i.result.items||null===i.result.items)throw"No item found/generated";i.resetResult===!0&&($(i.me._htmlIds.resultListId).update("").insert({bottom:i.me._getResultRow({title:"TITLE"},!0).wrap(new Element("thead"))}),$(i.me._htmlIds.totalCountDivId)&&$(i.me._htmlIds.totalCountDivId).update(i.result.pagination.totalRows)),i.tbody=$(i.me._htmlIds.resultListId).down("tbody"),i.tbody||$(i.me._htmlIds.resultListId).insert({bottom:i.tbody=new Element("tbody")}),i.result.items.each(function(t){i.tbody.insert({bottom:i.me._getResultRow(t)})}),"function"==typeof n&&n(),$(i.me._htmlIds.resultListId).insert({bottom:i.me._getPaginBtns(i.result.pagination)})}catch(o){$(i.me._htmlIds.resultListId).update(i.me.getAlertBox("ERROR",o).addClassName("alert-danger"))}}}),i.me},_submitExport:function(t){var e={};return e.me=this,e.fromDate=$F($$(".date-picker[export-crieria=date-from]").first()),e.toDate=$F($$(".date-picker[export-crieria=date-to]").first()),e.me.postAjax(e.me.getCallbackId("exportSats"),{fromDate:e.fromDate,toDate:e.toDate},{onLoading:function(){e.me._signRandID(t),jQuery("#"+t.id).button("loading")},onSuccess:function(t,o){try{if(e.result=e.me.getResp(o,!1,!0),!e.result||!e.result.url||e.result.url.blank())throw"No item found/generated";window.open(e.result.url),e.me.hideModalBox()}catch(n){e.me.showModalBox("ERROR",'<h4 class="text-danger">'+n+"</h4>")}},onComplete:function(){jQuery("#"+t.id).button("reset")}}),e.me},exportAll:function(){var t={};t.me=this,t.supported=!1,window.File&&window.FileReader&&window.FileList&&window.Blob&&(t.supported=!0),t.now=new Date,t.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"form-horizontal"}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"class":"col-sm-2 control-label"}).update("From:")}).insert({bottom:new Element("div",{"class":"col-sm-10"}).insert({bottom:new Element("input",{type:"text","class":"form-control date-picker",placeholder:"From Date","export-crieria":"date-from",value:t.now.getFullYear()+"-"+("00"+(1*t.now.getMonth()+1)).slice(2)+"-01"})})})}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"class":"col-sm-2 control-label"}).update("To:")}).insert({bottom:new Element("div",{"class":"col-sm-10"}).insert({bottom:new Element("input",{type:"text","class":"form-control date-picker",placeholder:"To Date","export-crieria":"date-to",value:t.now.getFullYear()+"-"+("00"+(1*t.now.getMonth()+1)).slice(2)+"-"+("00"+(1*t.now.getDate()+1)).slice(2)})})})}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"class":"col-sm-offset-2 col-sm-10"}).insert({bottom:t.exportBtn=new Element("a",{"class":"btn "+(t.usingIE===!0?"btn-warning":"btn-primary"),href:"javascript: void(0);","data-loading-text":"Exporting ... Please do NOT close this, while processing!"}).update(t.supported!==!0?"Your browser is NOT supported, pls change to anther and try again!":"Export Now").observe("click",function(){t.me._submitExport(this)})})})})}),t.supported!==!0&&t.exportBtn.writeAttribute("disabled",!0),pageJs.showModalBox("Please provide a date rage to export:",t.newDiv,!1),$$(".date-picker[export-crieria]").each(function(e){t.me._signRandID(e),e.store("date-picker",new Prado.WebUI.TDatePicker({ID:e.id,InputMode:"TextBox",PositionMode:"Bottom",Format:"yyyy-MM-dd"}))})}});