var PageJs=new Class.create;PageJs.prototype=Object.extend(new FrontPageJs,{resultDivId:"",getProductsBtn:"",pagination:{pageNo:1,pageSize:10},searchCriteria:{searchString:"",categoryIds:[],searchOpt:"",searchCat:"",language:"",productType:""},getProductItemFunc:"_getProductGridItem",searchProductUrl:"/products/search/{searchTxt}",initialize:function(t,e){this.resultDivId=t,this.getProductsBtn=e},showProducts:function(t,e){var n={};return n.me=this,n.clear=t===!0?!0:!1,n.clear===!0&&(this.pagination.pageNo=1,$(n.me.resultDivId).update(n.me._getLoadingDiv())),pageJs.postAjax(this.getProductsBtn,{pagination:n.me.pagination,searchCriteria:n.me.searchCriteria},{onLoading:function(){},onComplete:function(t,i){n.clear===!0&&(n.list="_getProductGridItem"===n.me.getProductItemFunc?new Element("div",{"class":"row"}):new Element("ul",{"class":"media-list"}),n.list.addClassName("plist"),n.me.searchCriteria.searchString.blank()||n.list.insert({top:new Element("h4").update("搜索结果 / 搜索結果 / Search result for: "+n.me.searchCriteria.searchString)}),$(n.me.resultDivId).update(n.list));try{if(n.result=pageJs.getResp(i,!1,!0),!n.result.pagination||0===n.result.pagination.totalRows)throw"Nothing found!";n.list=$(n.me.resultDivId).down(".plist"),n.result.products.each(function(t){n.list.insert({bottom:n.me[n.me.getProductItemFunc](t)})}),$(n.me.resultDivId).insert({bottom:n.me._getPaginationDiv(n.result.pagination)})}catch(s){$(n.me.resultDivId).insert({bottom:n.me.getAlertBox("ERROR: "+s).addClassName("alert-danger")})}"function"==typeof e&&e()}}),this},_getLoadingDiv:function(){return new Element("span",{"class":"loading"}).insert({bottom:new Element("img",{src:"/images/loading.gif"})}).insert({bottom:"Loading ..."})},_getPaginationDiv:function(t){var e={};if(!(t.pageNumber>=t.totalPages))return e.me=this,new Element("div",{"class":"pagination_wrapper pull-right"}).insert({bottom:e.me._getPaginationBtn("查看更多 / 查看更多<br />Get more",t.pageNumber+1)})},changePage:function(t,e,n){this.pagination.pageNo=e,this.pagination.pageSize=n,$(t).update("Getting more ....").writeAttribute("disabled",!0),this.showProducts(!1,function(){$(t).up(".pagination_wrapper").remove()})},_getPaginationBtn:function(t,e){var n={};return n.me=this,new Element("button",{"class":"btn btn-primary",type:"button"}).update(t).observe("click",function(){n.me.changePage(this,e,n.me.pagination.pageSize)})},_getProductListItem:function(t){var e={};return e.me=this,e.productDiv=new Element("div",{"class":"row nodefault plistitem"}).insert({bottom:new Element("div",{"class":"col-xs-3"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("a",{href:e.me.getProductDetailsUrl(t.id)}).insert({bottom:e.me._getProductImgDiv(t.attributes.image_thumb||null).addClassName("img-thumbnail")})})})}).insert({bottom:new Element("div",{"class":"col-xs-9"}).insert({bottom:new Element("a",{"class":"product_title",href:e.me.getProductDetailsUrl(t.id)}).insert({bottom:new Element("h4").update(t.title)})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-5"}).insert({bottom:new Element("strong").insert({bottom:"Author:"})})}).insert({bottom:new Element("div",{"class":"col-sm-7"}).update(t.attributes.author?e.me._getAttrString(t.attributes.author).join(" "):"")})})}).insert({bottom:new Element("div",{"class":"col-xs-6"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-5"}).insert({bottom:new Element("strong").insert({bottom:"ISBN:"})})}).insert({bottom:new Element("div",{"class":"col-sm-7"}).update(t.attributes.isbn?e.me._getAttrString(t.attributes.isbn).join(" "):"")})})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-5"}).insert({bottom:new Element("strong").insert({bottom:"Publisher:"})})}).insert({bottom:new Element("div",{"class":"col-sm-7"}).update(t.attributes.publisher?e.me._getAttrString(t.attributes.publisher).join(" "):"")})})}).insert({bottom:new Element("div",{"class":"col-xs-6"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-5"}).insert({bottom:new Element("strong").insert({bottom:"Pub. Date:"})})}).insert({bottom:new Element("div",{"class":"col-sm-7"}).update(t.attributes.publish_date?e.me._getAttrString(t.attributes.publish_date).join(" "):"")})})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("small").insert({bottom:t.attributes.description?e.me._getAttrString(t.attributes.description).join(" "):""})})})}),e.productDiv},_getProductGridItem:function(t){return new Element("div",{"class":"col-md-3 col-sm-4 col-xs-6"}).update(this._getProductThumbnail(t))},_getAttrString:function(t){return t.map(function(t){return t.attribute||""})},searchProducts:function(t){var e={};return e.me=this,$F(t).blank()?e.me.showModalBox("ERROR","没什么可搜索 / 沒什麼可搜索<br />Nothing to Search.",!0):window.location=e.me.searchProductUrl.replace("{searchTxt}",$F(t)),e.me}});