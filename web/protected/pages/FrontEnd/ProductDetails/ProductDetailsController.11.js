var PageJs=new Class.create();PageJs.prototype=Object.extend(new FrontPageJs(),{product:null,resultDivId:"",_joinAtts:function(a,b){var c={};c.attrs=[];if(a){a.each(function(d){c.attrs.push(d[b])})}return c.attrs},_getAtts:function(e,d,c,a){var b={};b.me=this;if(!b.me.product.attributes[e]&&!a){return[]}b.overRideContent=(a||"");return new Element("span",{"class":c}).addClassName(c).insert({bottom:new Element("label").update(d)}).insert({bottom:new Element("span").update((!b.overRideContent?b.me._joinAtts(b.me.product.attributes[e],"attribute").join(", "):b.overRideContent))})},_getLoadingImg:function(a){return new Element("span",{"class":"loadingImg",id:a})},displayProduct:function(){var a={};a.me=this;a.thumbImg=new Element("div",{"class":"product_image"});if(!a.me.product.attributes.image_thumb||a.me.product.attributes.image_thumb.size()===0){a.thumbImg.addClassName("noimage")}else{a.thumbImg.insert({bottom:new Element("img",{src:"/asset/get?id="+a.me.product.attributes.image_thumb[0]["attribute"]})})}a.newDiv=new Element("div",{"class":"wrapper"}).insert({bottom:new Element("div",{"class":"product listitem"}).insert({bottom:new Element("span",{"class":"inlineblock listcol left"}).update(a.thumbImg)}).insert({bottom:new Element("span",{"class":"inlineblock listcol right"}).insert({bottom:new Element("div",{id:"socialBtns","class":"socialBtns"})}).insert({bottom:new Element("div",{"class":"product_title"}).update(a.me.product.title)}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:a.me._getAtts("author","Author","inlineblock author")}).insert({bottom:a.me._getAtts("isbn","ISBN","inlineblock product_isbn")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:a.me._getAtts("publisher","Publisher","inlineblock product_publisher")}).insert({bottom:a.me._getAtts("publish_date","Publisher Date","inlineblock product_publish_date")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:a.me._getAtts("no_of_words","Length","inlineblock product_no_of_words")}).insert({bottom:a.me._getAtts("languages","Languages","inlineblock product_languages",a.me._joinAtts(a.me.product.languages,"name").join(", "))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:a.me._getAtts("copies_for_view","Available Copies For Read Online","inlineblock copies_for_view",a.me._getLoadingImg("copies_for_view"))}).insert({bottom:a.me._getAtts("copies_for_download","Available Copies For Download","inlineblock copies_for_download",a.me._getLoadingImg("copies_for_download"))})}).insert({bottom:new Element("div",{"class":"row product_description"}).update(a.me._getAtts("description","",""))}).insert({bottom:new Element("div",{"class":"row btns"}).insert({bottom:a.me._getLoadingImg("view_btn")}).insert({bottom:a.me._getLoadingImg("downloadBtn")})})})});$(a.me.resultDivId).update(a.newDiv);socialBtnJs.load("socialBtns");a.me._getCopies("copies_for_view","copies_for_download","view_btn","downloadBtn");return this},_getCopies:function(c,e,b,d){var a={};a.me=this;a.me.postAjax(a.me.getCallbackId("getCopies"),{},{onLoading:function(){},onComplete:function(f,h){try{a.result=a.me.getResp(h,false,true);a.availForView=a.result.copies.availForView;a.availForDownload=a.result.copies.availForDownload;if(a.result.urls.viewUrl&&a.availForView*1>0){$(c).replace(new Element("span").update(a.availForView+" out of "+a.result.copies.totalForView));$(b).replace(new Element("span",{"class":"button rdcrnr"}).update("在线阅读/在線閱讀<br />Read Online").observe("click",function(){a.me._getLink(this,"read")}))}else{$(c).replace("N/A");$(b).replace("")}if(a.result.urls.downloadUrl&&a.availForDownload*1>0){$(e).replace(new Element("span").update(a.availForDownload+" out of "+a.result.copies.totalForDownload));$(d).replace(new Element("span",{"class":"button rdcrnr"}).update("下载阅读/下載閱讀<br />Download This Book").observe("click",function(){a.me._getLink(this,"download")}))}else{$(e).replace("N/A");$(d).replace("")}}catch(g){alert(g)}}},120000)},_getLink:function(b,c){var a={};a.me=this;$(b).writeAttribute("originvalue",$(b).innerHTML);a.me.getUser(b,function(){a.me.postAjax(a.me.getCallbackId("geturl"),{type:c},{onLoading:function(){},onComplete:function(d,g){try{a.result=a.me.getResp(g,false,true);if(a.result.url){window.open(a.result.url)}if(a.result.redirecturl){window.location=a.result.redirecturl}}catch(f){alert(f)}$(b).update($(b).readAttribute("originvalue")).writeAttribute("disabled",false)}},120000)},function(){$(b).update("Processing ...").writeAttribute("disabled",true)},function(){console.debug("test");$(b).update($(b).readAttribute("originvalue")).writeAttribute("disabled",false)})}});