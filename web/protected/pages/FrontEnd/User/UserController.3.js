var PageJs=new Class.create();PageJs.prototype=Object.extend(new FrontPageJs(),{resultDivId:"",pagination:{pageNo:1,pageSize:5},borrowStatusId:"",showBookShelf:function(a,c){var b={};b.me=this;b.clear=(a===true?true:false);if(b.clear===true){this.pagination.pageNo=1;$(b.me.resultDivId).update(b.me._getLoadingDiv())}pageJs.postAjax(b.me.getCallbackId("getProducts"),{pagination:b.me.pagination},{onLoading:function(){},onComplete:function(d,g){b.resultDiv=$(b.me.resultDivId);if(b.clear===true){b.resultDiv.update("")}try{b.result=pageJs.getResp(g,false,true);if(!b.result.pagination||b.result.pagination.totalRows===0||b.result.items.size()===0){throw"Nothing on your shelf!"}b.result.items.each(function(e){b.resultDiv.insert({bottom:b.me._getProductListItem(e)})});if(b.result.pagination.pageNumber<b.result.pagination.totalPages){b.resultDiv.insert({bottom:b.me._getPaginationDiv(b.result.pagination)})}}catch(f){if(b.clear===true){b.resultDiv.update(f)}else{alert(f)}}if(typeof(c)==="function"){c()}}});return this},_getLoadingDiv:function(){return new Element("span",{"class":"loading"}).insert({bottom:new Element("img",{src:"/themes/default/images/loading.gif"})}).insert({bottom:"Loading ..."})},_getPaginationDiv:function(a){var b={};if(a.pageNumber>=a.totalPages){return}b.me=this;return new Element("div",{"class":"pagination_wrapper fullwith"}).insert({bottom:b.me._getPaginationBtn("查看更多 / 查看更多<br />Get more",a.pageNumber+1)})},removeItem:function(b,c){var a={};a.me=this;if(!confirm("You are removing this BOOK from your book shelf?\n\nContinue?")){return}pageJs.postAjax(a.me.getCallbackId("removeProduct"),{itemId:c},{onLoading:function(){$(b).addClassName("disabled loading")},onComplete:function(d,g){try{a.result=pageJs.getResp(g,false,true);if(a.result.item&&a.result.item.id){a.itemRow=$(a.me.resultDivId).down(".listitem[item_id="+a.result.item.id+"]");if(a.itemRow){a.itemRow.remove()}}}catch(f){alert(f);$(b).removeClassName("disabled loading")}}});return this},changePage:function(d,b,a){var c={};c.me=this;c.me.pagination.pageNo=b;c.me.pagination.pageSize=a;$(d).update("Getting more ....").writeAttribute("disabled",true);c.me.showBookShelf(false,function(){$(d).up(".pagination_wrapper").remove()})},_getPaginationBtn:function(a,b){var c={};c.me=this;return new Element("span",{"class":"fullwith button rdcrnr pagin_btn"}).update(a).observe("click",function(){c.me.changePage(this,b,c.me.pagination.pageSize)})},borrowItem:function(b,c){var a={};a.me=this;if(!confirm("You are trying to borrow this BOOK. / 您正试图借这本书. / 您正試圖借這本書. \n\n Continue / 继续 / 繼續 ?")){return}pageJs.postAjax(a.me.getCallbackId("borrowItem"),{itemId:c},{onLoading:function(){$(b).addClassName("disabled loading")},onComplete:function(d,g){try{a.result=pageJs.getResp(g,false,true);if(a.result.item&&a.result.item.id){a.itemRow=$(a.me.resultDivId).down(".listitem[item_id="+a.result.item.id+"]");if(a.itemRow){a.itemRow.replace(a.me._getProductListItem(a.result.item))}}alert("You have successfully borrowed this book./ 您已成功借这本书. / 您已成功借這本書.")}catch(f){alert(f);$(b).removeClassName("disabled loading")}}});return this},returnItem:function(b,c){var a={};a.me=this;if(!confirm("You are trying to return this BOOK./ 你正在试图返回本书. / 你正在試圖返回本書。 \n\n Continue / 继续 / 繼續 ?")){return}pageJs.postAjax(a.me.getCallbackId("returnItem"),{itemId:c},{onLoading:function(){$(b).addClassName("disabled loading")},onComplete:function(d,g){try{a.result=pageJs.getResp(g,false,true);if(a.result.item&&a.result.item.id){a.itemRow=$(a.me.resultDivId).down(".listitem[item_id="+a.result.item.id+"]");if(a.itemRow){a.itemRow.replace(a.me._getProductListItem(a.result.item))}}alert("You have successfully returned this book. / 您已成功返回本书。 / 您已成功返回本書。")}catch(f){alert(f);$(b).removeClassName("disabled loading")}}});return this},_getBtnDiv:function(b){var a={};a.me=this;a.newDiv=new Element("div",{"class":"row btns"}).insert({bottom:new Element("span",{"class":"imgBtn delBtn",title:"Remove From My Shelf / 从我的书柜中删除 / 從我的書櫃中刪除"}).observe("click",function(){a.me.removeItem(this,b.id)})});return a.newDiv},_getProductListItem:function(b){var a={};a.me=this;if(!b.product||!b.product.id){return null}a.productDiv=new Element("div",{"class":"product listitem",item_id:b.id}).store("data",b).insert({bottom:new Element("span",{"class":"inlineblock listcol left"}).insert({bottom:a.me._getProductImgDiv(b.product.attributes.image_thumb||null).addClassName("cursorpntr").observe("click",function(){a.me.showDetailsPage(b.product.id)})})}).insert({bottom:new Element("span",{"class":"inlineblock listcol right"}).insert({bottom:new Element("div",{"class":"product_title"}).update(b.product.title).addClassName("cursorpntr").observe("click",function(){a.me.showDetailsPage(b.product.id)})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("span",{"class":"author inlineblock"}).insert({bottom:new Element("label").update("Author:")}).insert({bottom:new Element("span").update(b.product.attributes.author?a.me._getAttrString(b.product.attributes.author).join(" "):"")})}).insert({bottom:new Element("span",{"class":"product_isbn inlineblock textright"}).insert({bottom:new Element("label").update("ISBN:")}).insert({bottom:new Element("span").update(b.product.attributes.isbn?a.me._getAttrString(b.product.attributes.isbn).join(" "):"")})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("span",{"class":"product_publisher inlineblock"}).insert({bottom:new Element("label").update("Publisher:")}).insert({bottom:new Element("span").update(b.product.attributes.publisher?a.me._getAttrString(b.product.attributes.publisher).join(" "):"")})}).insert({bottom:new Element("span",{"class":"product_publish_date inlineblock textright"}).insert({bottom:new Element("label").update("Publisher Date:")}).insert({bottom:new Element("span").update(b.product.attributes.publish_date?a.me._getAttrString(b.product.attributes.publish_date).join(" "):"")})})}).insert({bottom:a.me._getBtnDiv(b)}).insert({bottom:new Element("div",{"class":"product_description"}).update((b.product.attributes.description?a.me._getAttrString(b.product.attributes.description).join(" "):""))})});return a.productDiv},_getAttrString:function(a){return a.map(function(b){return b.attribute||""})}});